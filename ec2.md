[목차](https://garamgaram5.github.io/blog)   

### 배포(Deployment)란?   
이제 구현도 끝났으니 배포 하자!   
다른 사용자들이 인터넷을 통해 사용할 수 있게 만드는 것   
   
자신의 컴퓨터로 개발하면 localhost 라는 주소로 개발, 테스트   
다른 컴퓨터에서 접근이 불가능한 주소   
배포를 하면, IP나 도메인 같이 고유한 주소를 부여 받게 되고, 다른 컴퓨터에서 접속 가능   
 -> 이렇게 만드는 게 배포   
   
백엔드 개발 -> 백엔드 서버 완성법 배움 (Springboot, NodeJS계열 express 서버, nestJS 서버 등)   
백엔드 서버 만드는 역량 갖춘 후 배운 것이 <배포>   
   
### EC2는 무엇, 왜 배우는가   
EC2 = 컴퓨터를 빌려서 원격으로 접속해 사용하는 서비스   
= 하나의 컴퓨터    
   
서버 배포를 위해서는 컴퓨터가 필요   
내 컴퓨터로 서버 배포하면, 24시간 켜 놔야 함. 인터넷 통한 접근이라 보안 리스크   
그래서 EC2 라는 컴퓨터 빌려서 사용.    
EC2의 여러 부가 기능 많음 (로킹, 오토스케일링, 로드밸런싱 등)    
   
현업에서?    
백엔드에 서버를 배포할 때 EC2에 서버를 배포해서 사용   
(주로 백엔드 서버로 사용, 프론트엔드도 사용하기도 하지만, 프론트엔드 웹페이지 배포에는 주로 vercel, netify, 또는 AWS S3를 사용)   
   
### <실습>    
#### 1. 리전(Region) 선택   
EC2 -> 리전 선택!!!   

*리전이란, 인프라를 지리적으로 나누어 배포한 각각의 데이터 센터   
AWS EC2를 통해 빌릴 수 있는 컴퓨터가 전세계에 분포, 컴퓨터의 위치를 리전이라는 용어로 표현   
(특징)    
- AWS는 전 세계의 다양한 리전 보유   
- 각 리전은 고유한 이름, 고유값을 가지고 있다   

리전 선택 기준?
유저는 애플리케이션 사용시에, 네트워크 (인터넷) 통해서 통신.   
사용자와 애플리케이션을 실행시키는 컴퓨터의 위치가 멀어지만 속도 느려짐    
-> 애플리케이션의 주사용자의 위치와 지리적으로 가까운 리전을 선택하는 것이 유리   

리전마다 EC2가 따로 관리되니 유의!   
-> 아시아태평양(서울) 리전에 EC2 생성해 놓고,    
실수로 다른 리전(미국동부_버지니아 북부)에 들어가서 생성한 EC2 인스턴스가 없어졌다고 당황 
   
![Image](https://garamgaram5.github.io/blog/img/aws_region.png)
   
#### 2. (EC2 세팅하기) EC2 기본 세팅   
인스턴스 시작   
필수 부분 먼저 세팅!!!   
**이름 및 태그**   
- 다양한 서버 빌릴 것임. 인스턴스끼리 분리해서 식별할 수 있게 지정   
(예) 서비스이름-서버 instagram-server   
   
**OS**   
어떤 운영체제 ubuntu (Linux 디스트리뷰션) - 윈도우나 맥 보다 훨씬 가벼움   
버전: 22.04 디폴트의 최신번전. 프리티어    
   
**인스턴스 유형**   
*인스턴스? EC2에서 빌리는 컴퓨터 한 대   
*인스턴스의 유형 = 컴퓨터 사양   
프리티어인 t2.micro 라도 서비스 운영상의 성능엔 문제가 없다.    
(하루 방문자 수 2천명 정도의 서비스 문제 없었음)   
   
**키 페어(로그인)**   
EC2 컴퓨터에 아무나 접근 못하게 하는 비밀번호    
키 페어 생성 > 키 페어 이름은 EC2 컴퓨터에 접근하기 위한 키페어인지 알 수 있는 이름이 좋음   
(예)instagram-sever-key-pair
   
#### 3. (EC2 세팅하기) EC2 보안 그룹 설정
**네트워크 설정**
편집 클릭>   
	- VPC (AWS 익숙해지고 설정)   
	- **보안 그룹**   
		○ AWS 내의 네트워크 보안   
EC2 집 이라면, 보안 그룹은 울타리나 대문   
EC2(집)에 들어오기 전에, 보안 그룹(대문)에서 검사 -> 인바운드 트래픽 / 아웃바운드 트래픽   
		IP 범위 와 포트 로 설정   
		○ 보안그룹 생성 >   
보안 그룹 이름 : instagram-server-security-group   
security group rule 1 (TCP, 22, 0.0.0.0/0)   
유형: ssh (TCP / 22) -> 22번 포트로 원격접속을 허용   
소스유형: 위치 무관 -> 어떤 컴퓨터에 대해서든 원격 접속 허용   
   
security group rule 2 (TCP, 80, 0.0.0.0/0)   
유형: HTTP (TCP / 80) -> 80번 포트로 http 요청에 대해서는 인바운드 허용. 백엔드 서버를 80번 포트에 띄울 예정   
소스유형: 위치 무관 -> 어떤 컴퓨터에 대해서든 원격 접속 허용   
   
### [주요 개념] IP 와 Port   
IP: 네트워크 상에서 특정 컴퓨터를 가르키는 주소   
(예) 네이버의 아이피. 네이버가 운영하는 컴퓨터의 주소   
```markdown   
nslookup naver.com     
```     
   
```markdown  
Addresses: 223.130.195.200   
          223.130.195.95   
          223.130.200.107   
          223.130.200.104   
```    
Port: 한 컴퓨터 내에서 실행되고 있는 특정 프로그램의 주소   
(예) 13.250.15.132:3000   
이 컴퓨터의 3000번 포트에 할당된 프로그램의 번호   
왜 포트 필요? 하나의 컴퓨터에 여러 프로그램 실행중.    
외부에서 특정 서버의 스프링부트 프로그램에 에 접근하고 싶다면, 아이피와 포트 번호 까지 알아야 함   
-> 특정 서버, 프로그램과 통신하고 싶으면, IP와 Port 번호 알아야 함   
   
브라우저 창에 포트번호를 입력하지 않는 이유?   
브라우저는 기본적으로 80번 포트로 통신 보냄.    
다른 포트 번호로 통신하고 싶다면, 명시하면 됨.   
(예) naver.com:3000      
   
**잘 알려진 포트(well-known port)란?**   
포트 번호는 0~65,535 번까지 사용 가능   
그 중 0~1023번 까지의 포트 번호는 주요 통신을 위한 규약에 따라 이미 정해져 있음   
   
22번 ssh 원격접속 위한 포트번호 -> EC2 인스턴스에 연결할 때도 22번 포트 사용   
80번 http: http로 통신할 때 사용   
443번 https : https로 통신할 때 사용   
정해진 규칙을 꼭 지키진 않아도 됨. 특정서버와 HTTP 통신할 때 80번 대신 3000번이나 8080번 포트 써도 상관 없음   
   
#### 4. (EC2 세팅하기) 스토리지 구성   
스토리지란? EC2에서 쓰는 하드디스크 같은 것   
컴퓨터는 하드디스크 있음. 저장공간이 필요   
AWS EC2의 저장공간은 EBS(Elastic Block Storage)라 불림   
 EBS와 같은 저장공간을 조금 더 포괄적인 용어로 스토리지(Storage), 볼륨(Volume)이라고 부름   

크기(GB): 30 입력 -> 프리티어는 30GB까지 무료   
볼륨 유형: gp3(gp2 보다 최근 세대)   
나머지는 디폴트 세팅   

-> 인스턴스 시작   
대기 > 실행중
세부정보   
퍼블릭 IPv4 주소: 외부에서 접속 가능한 IP 주소   
인스턴스 상태: 실행중 (컴퓨터가 켜져 있음)   
ㄴ 인스턴스 중지 (컴퓨터 끔) / **인스턴스 종료 (컴퓨터 삭제)**
   
보안   
보안그룹   
   
네트워킹   
퍼블릭 IPv4 주소   

상태검사    
잘 안봄   
   
스토리지   
30GB   
   
모니터링   
서버 운영시에 자주 봄. 컴퓨터의 성능 지표   
   
태그    
잘 안 봄   
   
#### 5. EC2 접속하기   
연결 클릭   
>EC2 인스턴스 연결 (여러 방식있으나 이걸로 실습)   
EC2 Instance Connect 사용하여 연결   
: AWS 콘솔 자체에서 EC2 인스턴스에 연결하는 방식   
   
#### 6. 탄력적 IP 연결하기   
탄력적 IP가 필요한 이유? IP 고갈 막기 위해     
EC2가 할당받은 퍼블릭 IP는 임시적인 IP이다. 인스턴스를 중지시키고 다시 실행하면 IP가 바뀜   
인스턴스를 중지했다가 다시 실행해도 바뀌지 않는 고정 IP가 필요!   
현업에서도 EC2 인스턴스를 생성하면 탄력적 IP (고정 IP)를 필수적으로 설정 함   
   
탄력적 IP 설정 방법   
네트워크 및 보안> 탄력적 IP 주소 할당 클릭> 기본값 그대로 씀   
작업> 탄력적 IP 주소 연결 > 인스턴스 선택   
인스턴스 중지 > 시작 으로 IP 고정 되었는지 확인   
   
#### 7-1. Express 서버를 EC2에 배포하기   
EC2 서버 만들고, 배포 까지 연결해서 실습   
EC2 인스턴스 > 연결 > 원격 접속   
익스프레스 서버 구동 위해, nodejs 설치 (코드 복붙)   
   
#### 7-2. (보충 강의) Spring Boot 서버를 EC2에 배포하기   
Jdk 17 버전 설치   
   
#### 8. 비용 안나가게 EC2 깔끔하게 종료   
	ㄴ인스턴스 종료 > 탄력적 IP 릴리즈 > 키 페어 삭제   
