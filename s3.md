[목차](https://garamgaram5.github.io/blog)    
### [S3] 파일 및 이미지 업로드    
    
#### S3란?    
파일을 업로드, 저장하는 서비스    
구글 드라이브, iCloud와 같은 종류의 서비스    
    
#### S3를 왜 사용하나요?    
백엔드 서버를 구현 때 이미지 업로드 기능을 구현할 때가 많음.     
이 이미지 파일을 저장하기 위한 스토리지가 필요    
EC2 내부에 이미지 파일 저장도 가능하나 조금만 운영해보면 EC2에 쌓이는 파일들이 너무 많고 관리 어려움    
S3는 파일 저장에 특화된 서비스. 파일 저장 뿐아니라 다운로드도 최적화 됨     
    
#### 현업에서도?    
현업에서 파일 업로드 기능을 구현할 때 대부분 AWS S3를 활용함    
    
#### S3를 활용한 아키텍처 구성    
이미지 파일 업로드 과정    
(정리 예정)    
    
#### (실습) 1. S3 버킷 생성    
AWS S3 용어 2가지    
- 버킷    
깃헙에서 여러 개의 repository를 만들 수 있듯이 S3에서도 여러 개의 저장소 생성 가능    
버킷이란 하나의 저장소    
    
- 객체    
S3에 업로드한 파일을 S3에서는 파일이 아니라 객체라고 부름    
객체란 S3 버킷에 업로드 된 파일    
    
S3 > 버킷 만들기     
    
버킷 이름:instagram-static-files    
리전: 그대로    

**퍼블릭 액세스 차단 설정**    
모든퍼블릭 액세스 차단 체크 해제!    
-> 다른 사람들이 이미지 다운로드 할 수 있도록 설정    
    
경고 메시지에 체크     
현재 설정으로 인해 이 버킷과 그 안에 포함된 객체가 퍼블릭 상태가 될 수 있음을 알고 있습니다.    
    
나머지 디폴트 > 버킷 만들기    
    
버킷만들고 나면, **정책 추가** 필요    
(구체적으로 어떤것에 대해 허용할 지)    
    
**정책(Policy)?**    
권한(Permission)을 정의하는 JSON 문서를 의미    
AWS는 기본적으로 대부분의 권한이 주어지지 않음    
AWS의 특정 리소스에 접근하려면 권한을 허용해 주어야 함    
권한을 허용할 때 작성하는 게 정책    
    
(실습에선) 특정 상품 이미지를 모든 사용자가 다운로드 할 수 있도록    
이미지 파일을 조회할 수 있게 정책 추가    
!일일이 정책 추가 필요하단 것 유념    
    
버킷 > 권한 > 버킷 정책 > 편집    
+새 문 추가    
작업 추가> 서비스 선택: S3 검색해 선택    
액세스 수준 - 읽기    
GetObject    
S3의 객체(파일)를 조회(다운로드)하는 권한을 허용한다는 의미    
    
> **리소스 추가**    
리소스 유형: object    
리소스 ARN(Amazon Resource Number)    
arn:aws:s3:::{BucketName}/{ObjectName}    
arn:aws:s3:::instagram-static-files/*    
S3 내부 지정한 버킷 안에 있는 모든 객체에 대한 조회 허용    
    
아래도 수정. 누구에게 접근허용? 모두에게    
"Principal": {}    
"Principal": "*"    
    
#### 2. S3에 파일 업로드 할수있도록 IAM에서 액세스 키 발급 받기    
정책은 모든 사용자들이 파일을 다운로드 받을 수 있게 허용    
기본적으로 AWS 리소스는 아무나 접근 못하게 막아놨기 때문에    
S3에 접근해서 파일을 업로드 할 수 있도록    
IAM에서 S3에 접근 가능한 권한 부여받아야 함    
아무나 파일을 업로드 하면 안되고, 백엔드 서버만 파일 업로드 하는 권한이 있어야 함    
    
IAM은 여러 서비스의 리소스의 액세스 총괄 담당    
IAM > 사용자 > 사용자 생성    
사용자이름: instagram-server    
> 권한 설정: 직접 정책 연결 (AWS가 미리 만들어둔 정책)    
권한 정책: s3로 검색 > AmazonS3FullAccess 체크 > 사용자 생성    
    
사용자 생성 후    
보안 자격 증명> 액세스 키 > 액세스 키 만들기    
(백엔드 서버가 쓰는 키)     
사용 사례: AWS 외부에서 실행되는 애플리케이션 선택    
태그 생략 후 액세스키 만듦. (csv 다운로드 해 둠)    
액세스 키는 출입증 발급과 같음     
    
#### 3. S3를 활용해 Express 서버에 이미지 업로드 기능 구현    
    
#### 4. 비용 나가지 않게 S3 깔끔하게 종료    
- (버킷 안의) 객체 삭제    
- 버킷 삭제    
(그외)    
- 엑세스 키 삭제    

